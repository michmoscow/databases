# 22. Декомпозиция


Схема таблицы

University  Researher   Conference  City

Stanford    Jenifer     VLDB'11     Seattle, US

* плохо все данные хранить в одной таблице, нельзя что-то добавлять по частям, надо целиком добавить строку (например, тяжело просто добавить место конференции, не добавляя ее участника)
* удаление информации - для удаления информации от том в какой конференции принимает участие удаляется целая строка (например, где есть инфа в каком универе сотрудник и пр)
* при обновлении, например, города конференции нужно менять все записи, где встречается город

* одна строка в таблице должна отражать ровно один факт об окружающем мире
* в этой таблице записано три факта (в каком универе ученый, конференция проходит в таком то городе, ученый в ней участвует)

* в декомпозиции должны быть общие столбцы, связывающие данные


# 23. Функциональные зависимости


T={A,B,C}
T1={A,B}  T2={B,C}

* безопасная декомпозиция позволяет получить исходную таблицу соединением (JOIN) двух таблиц
* если из того, что в двух строках одинаковое значение в столбце B, следует что у них одинаковое значение в столбце C и нет экземляров таблицы где это правило нарушается, тогда B функционально определяет C: B->C
* если В->C, то декомпозиция на T1 и T2 безопасная и T=T1 JOIN T2
* 

# 32. Ключевые аттрибуты


* ключ это столбец или набор столбцов, функционально определяющий все остальные столбцы в таблице
* двух строк с одинаковым значением ключа в таблице быть не может

# 33. Связи между таблицами


* ключ - гарантия отсутствия дубликатов в столбце
* в ячейке должно быть записано атомарное значение (скажем нельзя массив участников и пр)
* отдельная таблица (участник: ученый, конференция) для отражения факта участия в конференции
* внешний ключ - ограничение, связывающее 2 столбца из двух таблиц. Гарантия того, что в столбце ОТКУДА будут определены только значения, присутствующие в столбце КУДА. Столбец КУДА должен быть ключом в своей таблице
* Если в столбце КУДА удаляется строка, то есть варианты того, что может сделать БД, но она точно не допустит потери целостности
* Сущность - объект, запись в таблице. Связь - бинарная ассоциация между объектами из разных таблиц
* Связь многие ко многим (М:N): каждый исследователь может принимать участие в нескольких конференциях,в каждой конференции может принимать участие несколько исследователей. Нужна отдельная таблица
* Один ко многим (1:N) - один универ : много ученых, в таблице researcher foreign key на универ

# 34. Нормальная форма Бойса-Кодда

* если X->Y то X детерминант функциональной зависимости
* X->X тривиальная зависимость
* Нормальная форма Бойса-Кодда: В любой нетривиальной функциональной зависимости детерминантом является ключ

# 35. Ошибки при проектировании схемы


* зависимость от подключа. Если ключ составной и есть зависимость от подключа - противоречие с нормальной формой (подключ должен быть ключом, а не составной ключ)
* Транзитивная зависимость.

Uni Address Researcher (key)

Researcher->Uni

Uni->Address

как следствие Researcher->Address, что и есть в таблице, но есть зависимость Uni->Address, где аттрибут Uni не является ключом

* можно вводить несколько ключей в таблице, чтобы автоматически проверять уникальность аттрибута (поля). Есть только один Primary Key, остальные ключи - ключевое слово Unique. Пример: Uni  Researcher (Key) Email. Нужно ставить unique на Email, т.к. он уникален
* связь 1:N вместо M:N (слишком ограничено, например, [таблица: исследователь конференция] исследователь может принять участие только в одной конференции)
* связь M:N вместо 1:N (слишком свободно, например, [таблица: место конференция] конференция может быть проведена на нескольких площадках, хотя должна быть на одной)

# 36. Суррогатные ключи


* просто столбец с целочисленным значением, генерируемым базой
* удобно использовать из-за малого размера
* не надо забывать, про реальные ключи (не суррогатные) - на них можно накладывать ограничения unique и пр

Грабли

Таблица Uni   Researcher   Email   id (primary key).

Надо также объявить ключами (unique) Researcher и Email, иначе можно внести неправильную инфу

# 37. Что нужно запомнить про ключи, связи и нормальные формы


* в каждой таблице столбцы, являющиеся ключами, должны быть объявлены ключами
* везде выполняется нормальная форма Бойса-Кодда

# Задачи


* select conf from (select q1.conference as conf from paper as q1 join paper as q2 on q1.conference=q2.conference where q1.location!=q2.locaton order by q1.conference) group by conf;
* select title from paper where paper.conference not in (select value from conference);

